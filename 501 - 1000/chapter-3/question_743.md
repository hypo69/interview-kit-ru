### `question_743.md`

**Вопрос 743.** Что такое фикстуры (fixtures) в PyTest, и какие встроенные фикстуры вы знаете, которые используются для тестирования потоков ввода-вывода, логирования и отчетов?

- A. Фикстуры - это способ создания и выполнения тестов в PyTest, не требующий описания кода.
- B. Фикстуры - это специальные декораторы для  функций, которые возвращают значения, которые могут использоваться в тестовых функциях. Pytest предоставляет множество встроенных фикстур, таких как: `capfd`, `capfdbinary`, `capsys`, `capsysbinary` (для работы с потоками ввода-вывода), `caplog` (для логирования) и `recwarn` (для обработки предупреждений).
- C. Фикстуры - это обьекты которые используются  для создания динамических классов, которые меняют поведение функций.
-  D. Фикстуры - это альтернативный способ описания функций в PyTest.

**Правильный ответ: B**

**Объяснение:**

В PyTest фикстуры (fixtures) — это мощный механизм, который позволяет создавать и управлять тестовыми окружениями, предоставлять тестовые данные и ресурсы для тестовых функций. PyTest предоставляет много встроенных фикстур для разных целей.

*   **Основные характеристики фикстур:**
    *  **Подготовка к тестам:** Фикстуры могут использоваться для подготовки данных, ресурсов или окружения, которые необходимы для тестов.
    *   **Повторное использование:**  Позволяют многократно использовать один и тот же код для подготовки  тестов.
    *   **Автоматизация:** Фикстуры могут автоматически выполняться перед или после теста.
    *  **Аргументы:** Функции-тесты могут получать фикстуры как аргументы (dependency injection).
    *   **Управление ресурсами:** Позволяют  управлять ресурсами (например, открывать или закрывать файлы).
*   **Встроенные фикстуры PyTest:**
        * **Для работы с потоками ввода-вывода:**
             *  `capfd` - для перехвата стандартных потоков ввода и вывода, на уровне операционной системы (возвращает текст).
            *   `capfdbinary` -  для перехвата стандартных потоков ввода и вывода, на уровне операционной системы (возвращает байты).
            * `capsys` - для перехвата стандартных потоков ввода и вывода на уровне Python (возвращает текст)
            *  `capsysbinary` - для перехвата стандартных потоков ввода и вывода на уровне Python (возвращает байты)
        *   **Для логирования:**
             *    `caplog` - для работы с логами Python кода, позволяет изменять уровни логирования,  перехватывать и фильтровать сообщения.
        *  **Для отслеживания warning:**
             *   `recwarn` - используется для отслеживания предупреждений.
        *   **Для создания отчетов:**
             *   `doctest_namespace` - для работы с библиотекой `doctest`,  которая позволяет проверять  код в документации.
* **Как работают фикстуры**
    *  Pytest автоматически обнаруживает функции с декоратором `@pytest.fixture`.
     *  При вызове  тестовой функции, если в параметрах  функции  используется  имя фикстуры, то она будет  автоматически запущена.
     * Результат  работы фикстуры будет передан как аргумент тестовой функции.

**Примеры:**

```python
import pytest
import os
import logging
import warnings

# фикстура для работы с os
def test_system_echo(capfd):
      os.system('echo "hello"')
      captured = capfd.readouterr()
      assert captured.out == "hello\n"
# фикстура для работы с bytes
def test_system_echo2(capfdbinary):
      os.system('echo "hello"')
      captured = capfdbinary.readouterr()
      assert captured.out == b"hello\n"
# фикстура для python потока вывода
def test_output(capsys):
        print("hello")
        captured = capsys.readouterr()
        assert captured.out == "hello\n"

def test_output2(capsysbinary):
        print("hello")
        captured = capsysbinary.readouterr()
        assert captured.out == b"hello\n"

# фикстура для логов
def test_foo(caplog):
    caplog.set_level(logging.INFO)
    logging.info("test message for info level")
    for message in caplog.messages:
        assert "debug level" not in message

def func_under_test():
  logging.info("this is info")
  logging.warning("this is warning")
  logging.error("this is error")

def test_baz(caplog):
    func_under_test()
    for record in caplog.records:
        assert record.levelname != "CRITICAL"
    assert "wally" not in caplog.text

def test_check_warnings(recwarn):
    warnings.warn("hello", UserWarning)
    assert len(recwarn) == 1
    warn = recwarn.pop(UserWarning)
    assert issubclass(warn.category, UserWarning)
    assert str(warn.message) == "hello"
    assert warn.filename

import numpy
@pytest.fixture(autouse=True)
def add_np(doctest_namespace):
    doctest_namespace["np"] = numpy

def arange():
    """
    >>> a = np.arange(10)
    >>> len(a)
    10
    """
    pass

```
**Разбор вариантов:**
*  **A. Фикстуры - это способ создания и выполнения тестов в PyTest, не требующий описания кода.:** Неправильно.
*   **B. Фикстуры - это специальные декораторы для  функций, которые возвращают значения, которые могут использоваться в тестовых функциях. Pytest предоставляет множество встроенных фикстур, таких как: `capfd`, `capfdbinary`, `capsys`, `capsysbinary` (для работы с потоками ввода-вывода), `caplog` (для логирования) и `recwarn` (для обработки предупреждений).:** Правильно.
*  **C. Фикстуры - это обьекты которые используются  для создания динамических классов, которые меняют поведение функций.:** Неправильно.
*   **D. Фикстуры - это альтернативный способ описания функций в PyTest.:** Неправильно.

**В результате:**
*  Фикстуры позволяют  создавать гибкое и переиспользуемое тестовое окружение.
*  Pytest предоставляет множество встроенных  фикстур, для  различных задач.
*  `capfd`, `capfdbinary`, `capsys`, `capsysbinary`  позволяют работать с потоками ввода-вывода.
*   `caplog`  позволяет работать с  логированием.
* `recwarn` позволяет обрабатывать предупреждения.
* `doctest_namespace`  позволяет работать с доктестами.

Таким образом, правильным ответом является **B. Фикстуры - это специальные декораторы для  функций, которые возвращают значения, которые могут использоваться в тестовых функциях. Pytest предоставляет множество встроенных фикстур, таких как: `capfd`, `capfdbinary`, `capsys`, `capsysbinary` (для работы с потоками ввода-вывода), `caplog` (для логирования) и `recwarn` (для обработки предупреждений).**
